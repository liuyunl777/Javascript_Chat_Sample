function randomString(){for(var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n=16,e="",o=0;n>o;o++){var i=Math.floor(Math.random()*t.length);e+=t.substring(i,i+1)}return e}function Client(t){return t.appId&&t.apiKey?(this.mqttClient=null,this.info={appId:t.appId,apiKey:t.apiKey},this.clientId=t.clientId?t.clientId:null,this.onPPReceived=t.onPPReceived,this.onPPConnected=t.onPPConnected,this.onPPFail=t.onPPFail,this.onConnectionLost=t.onConnectionLost,this.RECONNECT_INTERVAL=1e3,this.reconnectInterval=null,void this.connect()):void alert(" appId, apiKey 반드시 필요합니다.")}function onConnectionLost(t){0!==t.errorCode&&console.log("onConnectionLost:"+t.errorMessage)}function uintToString(t){var n=String.fromCharCode.apply(null,t),e=decodeURIComponent(escape(n));return e}function bin2String(t){return String.fromCharCode.apply(String,t)}var PartnerPush={Client:Client,Utility:{createDeviceId:function(t){return t?t:randomString()+"0801"}}};Client.prototype.doCheckLoop=function(){var t=navigator.onLine;t||this.isConnecting||(this.isConnecting=!0,this.reconnectInterval=null,this.startReconnectInterval()),setTimeout(PartnerPush.doCheckLoop,1e3)},Client.prototype.connect=function(){var t=this;t.mqttClient&&t.mqttClient.isConnected()&&t.mqttClient.disconnect(),this.clientId=null!=this.clientId?this.clientId:PartnerPush.Utility.createDeviceId(),t.connectMQTT(t.getOnPPConnected())},Client.prototype.disconnect=function(){this.mqttClient.disconnect()},Client.prototype.startReconnectInterval=function(){console.log("리커넥트 인터벌 실행중");var t=this;if(!t.reconnectInterval){var n=navigator.onLine;n&&t.connect(),this.reconnectInterval=setInterval(function(){var n=navigator.onLine;n&&t.connect()},t.RECONNECT_INTERVAL)}},Client.prototype.connectMQTT=function(t){var n=this;this.mqttClient=new Paho.MQTT.Client("wss://biz.partner.so:7883/mqtt",this.clientId),this.mqttClient.onConnectionLost=this.getOnConnectionLost(),this.onPPReceived&&(this.mqttClient.onMessageArrived=this.getOnMessageArrived(this.onPPReceived)),this.mqttClient.connect({userName:this.info.appId,password:this.info.apiKey,onSuccess:t,onFailure:function(t){n.onPPFail&&n.onPPFail(t)}})},Client.prototype.getOnMessageArrived=function(t){return function(n){if(t){var e,o=this,i=[],r=[];try{for(var s=0,a=17;a>s;s++){e=n.payloadBytes[s],e=e.toString(2),i=[];for(var c=0,l=e.length;l>c;c++)if(i[c]=JSON.parse("["+e[c]+"]"),c==l-1)for(var C=0,d=8-i.length;d>C;C++)i.unshift(0);i=i.join(),i=i.replace(/,/gi,""),r.push(i)}}catch(p){console.log(p)}var h=r[0].substr(4,4),u=h.substr(0,1);u=0==u?!1:!0;var v=h.substr(1,2);v=0==v?"text":1==v?"XML":10==v?"JSON":"Binary";var g=h.substr(3,1);g=0==g?"Me":"You";for(var f=[],s=17,a=n.payloadBytes.length;a>s;s++)f[s-17]=n.payloadBytes[s];{new ArrayBuffer(f.byteLength)}f=uintToString(f);var y=new ArrayBuffer(n.payloadBytes.byteLength);new Uint8Array(y).set(n.payloadBytes);var P=new DataView(y),I=~~P.getFloat64(9);P=new Date(P.getFloat64(1));for(var m=[],L=n.qos,T=n.destinationName,s=17,a=n.payloadBytes.length;a>s;s++)e=n.payloadBytes[s],m.push(e);var S={isSpecial:u,isMine:g,msgType:v,sendDate:P,msgKey:I,content:f,binary:m,QOS:L,topic:T}}t?t(S):o.defaultMessageArrived(S)}},Client.prototype.defaultMessageArrived=function(t){alert(t)},Client.prototype.sendMessage=function(t,n,e){var o=new Paho.MQTT.Message(n);o.destinationName=t,void 0==e&&(e=1),o.qos=e,this.mqttClient.send(o)},Client.prototype.addTopic=function(t){this.mqttClient.subscribe(t)},Client.prototype.removeTopic=function(t){this.mqttClient.unsubscribe(t)},Client.prototype.getOnPPConnected=function(){var t=this;return function(){t.sid;console.log("CONNECT IS SUCCESSFULLY"),clearInterval(t.reconnectInterval),t.isConnecting=!1,t.onPPConnected&&t.onPPConnected()}},Client.prototype.getOnConnectionLost=function(){var t=this;return function(n){0!==n.errCode&&(console.log("UNCONNECT"),t.doCheckLoop(),t.onConnectionLost&&t.onConnectionLost())}};