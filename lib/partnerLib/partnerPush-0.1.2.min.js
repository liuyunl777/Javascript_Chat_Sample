function Client(t){return t.appId&&t.apiKey?(this.mqttClient=null,this.info={appId:t.appId,apiKey:t.apiKey},this.clientId=t.clientId?t.clientId:null,this.onPPReceived=t.onPPReceived,this.onPPConnected=t.onPPConnected,this.onPPFail=t.onPPFail,this.onConnectionLost=t.onConnectionLost,this.RECONNECT_INTERVAL=1e3,this.reconnectInterval=null,void this.connect()):void alert(" appId, apiKey 반드시 필요합니다.")}function onConnectionLost(t){0!==t.errorCode}function uintToString(t){var n=String.fromCharCode.apply(null,t),e=decodeURIComponent(escape(n));return e}function bin2String(t){return String.fromCharCode.apply(String,t)}var PartnerPush={Client:Client,Utility:{createDeviceId:function(t){return t?t:0+Math.random()+"0801"}}};Client.prototype.doCheckLoop=function(){var t=navigator.onLine;t||this.isConnecting||(this.isConnecting=!0,this.reconnectInterval=null,this.startReconnectInterval()),setTimeout(PartnerPush.doCheckLoop,1e3)},Client.prototype.connect=function(){var t=this;t.mqttClient&&t.mqttClient.isConnected()&&t.mqttClient.disconnect(),this.clientId=null!=this.clientId?this.clientId:PartnerPush.Utility.createDeviceId(),t.connectMQTT(t.getOnPPConnected())},Client.prototype.disconnect=function(){this.mqttClient.disconnect()},Client.prototype.startReconnectInterval=function(){var t=this;if(!t.reconnectInterval){var n=navigator.onLine;n&&t.connect(),this.reconnectInterval=setInterval(function(){var n=navigator.onLine;n&&t.connect()},t.RECONNECT_INTERVAL)}},Client.prototype.connectMQTT=function(t){var n=this;this.mqttClient=new Paho.MQTT.Client("wss://biz.partner.so:7883/mqtt",this.clientId),this.mqttClient.onConnectionLost=this.getOnConnectionLost(),this.onPPReceived&&(this.mqttClient.onMessageArrived=this.getOnMessageArrived(this.onPPReceived)),this.mqttClient.connect({userName:this.info.appId,password:this.info.apiKey,onSuccess:t,onFailure:function(t){n.onPPFail&&n.onPPFail(t)}})},Client.prototype.getOnMessageArrived=function(t){return function(n){if(t){var e,i=this,o=[],r=[];try{for(var s=0,a=17;a>s;s++){e=n.payloadBytes[s],e=e.toString(2),o=[];for(var c=0,l=e.length;l>c;c++)if(o[c]=JSON.parse("["+e[c]+"]"),c==l-1)for(var p=0,d=8-o.length;d>p;p++)o.unshift(0);o=o.join(),o=o.replace(/,/gi,""),r.push(o)}}catch(h){}var C=r[0].substr(4,4),u=C.substr(0,1);u=0==u?!1:!0;var v=C.substr(1,2);v=0==v?"text":1==v?"XML":10==v?"JSON":"Binary";var y=C.substr(3,1);y=0==y?"Me":"You";for(var f=[],s=17,a=n.payloadBytes.length;a>s;s++)f[s-17]=n.payloadBytes[s];new ArrayBuffer(f.byteLength);f=uintToString(f);var g=new ArrayBuffer(n.payloadBytes.byteLength);new Uint8Array(g).set(n.payloadBytes);var P=new DataView(g),I=~~P.getFloat64(9);P=new Date(P.getFloat64(1));for(var m=[],L=n.qos,T=n.destinationName,s=17,a=n.payloadBytes.length;a>s;s++)e=n.payloadBytes[s],m.push(e);var q={isSpecial:u,isMine:y,msgType:v,sendDate:P,msgKey:I,content:f,binary:m,QOS:L,topic:T}}t?t(q):i.defaultMessageArrived(q)}},Client.prototype.defaultMessageArrived=function(t){alert(t)},Client.prototype.sendMessage=function(t,n,e){var i=new Paho.MQTT.Message(n);i.destinationName=t,void 0==e&&(e=1),i.qos=e,this.mqttClient.send(i)},Client.prototype.addTopic=function(t){this.mqttClient.subscribe(t)},Client.prototype.removeTopic=function(t){this.mqttClient.unsubscribe(t)},Client.prototype.getOnPPConnected=function(){var t=this;return function(){t.sid;clearInterval(t.reconnectInterval),t.isConnecting=!1,t.onPPConnected&&t.onPPConnected()}},Client.prototype.getOnConnectionLost=function(){var t=this;return function(n){0!==n.errCode&&(t.doCheckLoop(),t.onConnectionLost&&t.onConnectionLost())}};